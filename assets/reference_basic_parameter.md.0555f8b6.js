import{_ as t,o as e,c as a,O as d}from"./chunks/framework.9482e208.js";const l="/assets/0.876faf52.png",r="/assets/1.c949eb54.png",c="/assets/cfg.30e9cfa9.jpg",b=JSON.parse('{"title":"文生图（txt2img）基本参数测试","description":"","frontmatter":{},"headers":[],"relativePath":"reference/basic_parameter.md","filePath":"reference/basic_parameter.md"}'),i={name:"reference/basic_parameter.md"},o=d('<h1 id="文生图-txt2img-基本参数测试" tabindex="-1">文生图（<code>txt2img</code>）基本参数测试 <a class="header-anchor" href="#文生图-txt2img-基本参数测试" aria-label="Permalink to &quot;文生图（`txt2img`）基本参数测试&quot;">​</a></h1><p>本文将通过实际跑图的方式测试<code>txt2img</code>的基本参数<code>Batch count</code>、<code>Batch size</code>、<code>Seed</code>、<code>CFG Scale</code>变化对<code>图片生成过程及图片内容、质量</code>的影响。</p><h2 id="测试环境" tabindex="-1">测试环境 <a class="header-anchor" href="#测试环境" aria-label="Permalink to &quot;测试环境&quot;">​</a></h2><table><thead><tr><th style="text-align:left;">环境参数</th><th style="text-align:center;">信息</th></tr></thead><tbody><tr><td style="text-align:left;">GPU型号</td><td style="text-align:center;">Tesla V100 SXM2 32 GB</td></tr><tr><td style="text-align:left;">xformers</td><td style="text-align:center;">启用</td></tr><tr><td style="text-align:left;">集成软件</td><td style="text-align:center;"><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui" target="_blank" rel="noreferrer">AUTOMATIC1111</a></td></tr><tr><td style="text-align:left;">基础模型</td><td style="text-align:center;">meinamix_meinaV9.safetensors [eac6c08a19]</td></tr></tbody></table><h2 id="原始参数" tabindex="-1">原始参数 <a class="header-anchor" href="#原始参数" aria-label="Permalink to &quot;原始参数&quot;">​</a></h2><p>在之后的测试中，如果没有特别提及，输入参数将使用如下表的值</p><table><thead><tr><th style="text-align:left;">输入参数</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Prompt</td><td style="text-align:center;">girl, white hair, wearing dress,lying on the beach, basking in the sun</td></tr><tr><td style="text-align:left;">Sampling method</td><td style="text-align:center;">DPM++ 2M Karras</td></tr><tr><td style="text-align:left;">Sampling steps</td><td style="text-align:center;">20</td></tr><tr><td style="text-align:left;">Width</td><td style="text-align:center;">512</td></tr><tr><td style="text-align:left;">Height</td><td style="text-align:center;">512</td></tr><tr><td style="text-align:left;">CFG Scale</td><td style="text-align:center;">7</td></tr><tr><td style="text-align:left;">Seed</td><td style="text-align:center;">-1</td></tr><tr><td style="text-align:left;">Batch count</td><td style="text-align:center;">1</td></tr><tr><td style="text-align:left;">Batch size</td><td style="text-align:center;">4</td></tr></tbody></table><p>上面没有提及的参数默认<code>不填</code>或者<code>不勾选</code>，这样我们得到原始图<img src="'+l+'" alt="img_0"></p><p>下表描述生成图片消耗的时间及占用的GPU资源</p><table><thead><tr><th style="text-align:left;">结果</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Time taken</td><td style="text-align:center;">4.72s</td></tr><tr><td style="text-align:left;">Torch active/reserved</td><td style="text-align:center;">2619/3252 MiB</td></tr><tr><td style="text-align:left;">Sys VRAM</td><td style="text-align:center;">4392/32511 MiB (13.51%)</td></tr></tbody></table><h2 id="batch-count" tabindex="-1">Batch count <a class="header-anchor" href="#batch-count" aria-label="Permalink to &quot;Batch count&quot;">​</a></h2><p><code>Batch count</code>指重复执行图片生成脚本的次数，对生成图片的质量没有影响。例如改变<code>Batch count</code>为<code>4</code>将消耗相对于原来4倍的时间并且得4批图片，每次执行的显存使用率不会变化。</p><table><thead><tr><th style="text-align:left;">结果</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Time taken</td><td style="text-align:center;">18.73s</td></tr><tr><td style="text-align:left;">Torch active/reserved</td><td style="text-align:center;">2619/3252 MiB</td></tr><tr><td style="text-align:left;">Sys VRAM</td><td style="text-align:center;">4392/32511 MiB (13.51%)</td></tr></tbody></table><p>在每个测试结束之后，都默认退回到原始参数，将<code>Batch count</code>改回<code>1</code>。</p><h2 id="batch-size-512-512情况下" tabindex="-1">Batch size（512*512情况下） <a class="header-anchor" href="#batch-size-512-512情况下" aria-label="Permalink to &quot;Batch size（512*512情况下）&quot;">​</a></h2><p><code>Batch size</code>是指每次生成的图片数量。测试结果表明在生成<code>512*512图片</code>时，获取同等数量的图片，调大<code>Batch size</code>更节省时间，并且显存使用率变化不大。但是过大的<code>Batch size</code>让我眼花缭乱，所以我倾向于设置<code>Batch size</code>为<code>4</code>，以便于肉眼挑选合适的图片进行下一步处理。以下为实际测试结果：</p><p>当<code>Batch size</code>值为<code>1</code>时，</p><table><thead><tr><th style="text-align:left;">结果</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Time taken</td><td style="text-align:center;">1.56s</td></tr><tr><td style="text-align:left;">Torch active/reserved</td><td style="text-align:center;">2599/2888 MiB</td></tr><tr><td style="text-align:left;">Sys VRAM</td><td style="text-align:center;">4028/32511 MiB (12.39%)</td></tr></tbody></table><p>当<code>Batch size</code>值为<code>4</code>时，</p><table><thead><tr><th style="text-align:left;">结果</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Time taken</td><td style="text-align:center;">4.72s</td></tr><tr><td style="text-align:left;">Torch active/reserved</td><td style="text-align:center;">2619/3252 MiB</td></tr><tr><td style="text-align:left;">Sys VRAM</td><td style="text-align:center;">4392/32511 MiB (13.51%)</td></tr></tbody></table><p>当<code>Batch size</code>值为<code>8</code>时，</p><table><thead><tr><th style="text-align:left;">结果</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Time taken</td><td style="text-align:center;">8.91s</td></tr><tr><td style="text-align:left;">Torch active/reserved</td><td style="text-align:center;">3160/3432 MiB</td></tr><tr><td style="text-align:left;">Sys VRAM</td><td style="text-align:center;">4590/32511 MiB (14.12%)</td></tr></tbody></table><h2 id="seed" tabindex="-1">Seed <a class="header-anchor" href="#seed" aria-label="Permalink to &quot;Seed&quot;">​</a></h2><p>如果你希望获取相同的图片，那么使用一个确定的<code>Seed</code>（前提是包含硬件条件在内的其它相关参数不变化）。如果你希望随机获取一张图片，则将<code>Seed</code>设定为<code>-1</code>，这样每次生成图片的时候就会随机生成一个<code>Seed</code>值。 例如你随机生成一张图片， <img src="'+r+'" alt="img_1"></p><p>你感觉这个图还可以，那么你可以记下它的<code>Seed</code>值<code>4175639649</code>。在其它参数不变的条件下，你设定<code>Seed</code>为<code>4175639649</code>，点击生成将得到一张完全一致的图片。</p><h2 id="cfg-scale" tabindex="-1">CFG Scale <a class="header-anchor" href="#cfg-scale" aria-label="Permalink to &quot;CFG Scale&quot;">​</a></h2><p><code>CFG Scale</code>用于控制模型应该在多大程度遵循你的<code>Prompt</code>。 该测试中，加入另一组输入参数对比，只改变Prompt其余和原始参数一致</p><table><thead><tr><th style="text-align:left;">输入参数</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Prompt</td><td style="text-align:center;">girl, white hair, wearing dress,sipping coffee by a café</td></tr></tbody></table><p>借助脚本<code>X/Y/Z plot</code>及<code>Prompt S/R</code>测试<code>CFG Scale</code>变化对图片质量的影响。如下图所示，当<code>CFG Scale</code>值为0时，模型自由发挥完全无视你的<code>Prompt</code>。 <img src="'+c+'" alt="cfg"></p><h2 id="sampling-method" tabindex="-1">Sampling method <a class="header-anchor" href="#sampling-method" aria-label="Permalink to &quot;Sampling method&quot;">​</a></h2><p>TODO</p><p>关于<code>Sampling method</code>我也没有啥研究，平时基本上都是无脑<code>DPM++ 2M Karras</code>，<code>AUTOMATIC1111</code>的wiki也只是给出了一张参照表。</p><p>因为Sampling method数量太多，我们宏观上把他们大至分个类然后挑几个典型跑一下。</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><p><a href="https://stable-diffusion-art.com/samplers/" target="_blank" rel="noreferrer">https://stable-diffusion-art.com/samplers/</a></p>',35),n=[o];function s(h,g,y,x,p,f){return e(),a("div",null,n)}const _=t(i,[["render",s]]);export{b as __pageData,_ as default};
