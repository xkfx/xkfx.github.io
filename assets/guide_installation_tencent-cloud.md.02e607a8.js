import{_ as s,o as a,c as n,O as l}from"./chunks/framework.9482e208.js";const d=JSON.parse('{"title":"腾讯云部署SD集成环境","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/installation/tencent-cloud.md","filePath":"guide/installation/tencent-cloud.md"}'),o={name:"guide/installation/tencent-cloud.md"},p=l(`<h1 id="腾讯云部署sd集成环境" tabindex="-1">腾讯云部署SD集成环境 <a class="header-anchor" href="#腾讯云部署sd集成环境" aria-label="Permalink to &quot;腾讯云部署SD集成环境&quot;">​</a></h1><p>这边以腾讯云为例，详解集成环境的安装。阅读本文可能需要一些编程基础。</p><h2 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h2><h3 id="服务器选择" tabindex="-1">服务器选择 <a class="header-anchor" href="#服务器选择" aria-label="Permalink to &quot;服务器选择&quot;">​</a></h3><p>配置的选择。GPU是最重要最基础的配置。经济允许尽量选择显存大的。</p><p>地区的选择。如果选择国内的服务器，在安装基础环境、插件、模型的过程可能会遇到很多网络相关的问题，但是相对来说的好处是部署好的服务器出图不容易出现网络问题，就是说你跑的图可以即时拿到。如果选择国外的服务器，那么你安装基础环境、插件、模型可能会很顺利，但是你需要建立额外的一个图片浏览网站（当然，这个很简单！）。</p><h3 id="配置安全组" tabindex="-1">配置安全组 <a class="header-anchor" href="#配置安全组" aria-label="Permalink to &quot;配置安全组&quot;">​</a></h3><p>不配置安全组就不能远程访问服务器上的sdui。</p><p>腾讯云的实例和相关配置是按地区划分的，进入腾讯云控制台，找到<code>网络与安全</code>&gt;<code>安全组</code>，找到服务器所在的位置，例如<code>东京</code>，找到实例对应的安全组，点击<code>修改规则</code>，先执行<code>一键放通</code>，然后放通sdui和图片浏览程序所需要的端口，个人使用使用<code>7860</code>和<code>8080</code>端口，因为这两个是之后sdui和图片浏览程序所默认的，点击<code>添加规则</code>按下表填写。</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:center;">值</th></tr></thead><tbody><tr><td style="text-align:left;">类型</td><td style="text-align:center;">自定义</td></tr><tr><td style="text-align:left;">来源</td><td style="text-align:center;">0.0.0.0/0</td></tr><tr><td style="text-align:left;">协议端口</td><td style="text-align:center;">TCP:7860,8080</td></tr><tr><td style="text-align:left;">策略</td><td style="text-align:center;">允许</td></tr><tr><td style="text-align:left;">备注</td><td style="text-align:center;">sd,imgshow</td></tr></tbody></table><p>配置安全组有比较快捷的操作，配置好的安全组可以复用，可以自己研究一下。</p><h3 id="登陆" tabindex="-1">登陆 <a class="header-anchor" href="#登陆" aria-label="Permalink to &quot;登陆&quot;">​</a></h3><p>具体方式不在本文讨论范围内。个人比较习惯，一个是通过腾讯云控制台直接登陆；另一个是通过一款叫做Xshell的软件登陆。两者没有太大的区别，只是一个基于浏览器，一个基于软件，我感觉后者更稳定一点。</p><h2 id="gpu资源监控" tabindex="-1">GPU资源监控 <a class="header-anchor" href="#gpu资源监控" aria-label="Permalink to &quot;GPU资源监控&quot;">​</a></h2><p>第一次登陆云服务器不着急安装sdui，通过<code>nvidia-smi</code>指令查看GPU情况，例如GPU型号以及目前的使用情况、温度等。还可以看到正在使用GPU的进程，有时候sdui卡了，或者出现一些其它异常，我们可以在这里找到它的PID，通过<code>kill -9 具体PID</code>来强制终止进程，避免白白占用GPU资源。</p><p>个人习惯实时去看GPU情况，使用<code>watch -n 2 nvidia-smi</code>指令，意思每隔两秒就自动执行一次<code>nvidia-smi</code>，这样我们在屏幕上可以实时看到GPU使用情况。当然，这样子这个窗口就不能用了，我们打开另一个窗口继续操作。</p><h2 id="sdui的安装" tabindex="-1">sdui的安装 <a class="header-anchor" href="#sdui的安装" aria-label="Permalink to &quot;sdui的安装&quot;">​</a></h2><p>遵循<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui" target="_blank" rel="noreferrer">AUTOMATIC1111官方主页</a>的做法！</p><p>这边买的服务器操作系统是Ubuntu 20.04执行下面的指令，如果是境内服务器可能会非常痛苦。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python3-venv</span></span>
<span class="line"><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;(</span><span style="color:#FFCB6B;">wget</span><span style="color:#C3E88D;"> -qO- https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui/master/webui.sh</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>它会默认安装一个基础模型，安装好之后它会自动启动。但这个启动是无效的，我们访问不了。判断是否安装完并启动，查看是不是给出了一个访问sdui的链接。</p><h2 id="首次启动sdui" tabindex="-1">首次启动sdui <a class="header-anchor" href="#首次启动sdui" aria-label="Permalink to &quot;首次启动sdui&quot;">​</a></h2><p>我们通过<code>ctrl+C</code>可以结束掉一个当前正在跑着的sdui。</p><p>通过<code>ls</code>可以查看当前目录下的文件夹及文件，因为我们已经在当前目录执行了<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui" target="_blank" rel="noreferrer">AUTOMATIC1111官方主页</a>的指令，<code>ls</code>回车后可以看到一个<code>stable-diffusion-webui</code>文件夹，通过<code>cd s+tab</code>回车可以快速进入这个文件夹。</p><p>然后执行该文件夹下的脚本，通过指令<code>./webui.sh --listen --xformers</code>启动sdui集成环境，<code>--listen</code>可以让远程访问sdui，而<code>--xformers</code>可以大大加速图片生成速度并节省GPU资源的占用，个人测试使用该指令。</p><p>启动成功后通过<code>http://43.133.182.26:7860/</code>访问sdui，把<code>43.133.182.26</code>替换成你购买的腾讯云服务器公网IP。</p><h2 id="图片浏览程序的搭建" tabindex="-1">图片浏览程序的搭建 <a class="header-anchor" href="#图片浏览程序的搭建" aria-label="Permalink to &quot;图片浏览程序的搭建&quot;">​</a></h2><p>现在sdui已经安装成功，通过链接也可以正常访问。随便点击<code>Generate</code>可以顺利生成图片（实际生成进度可以观察服务器命令行的输出），但是由于是境外的服务器，当图片比较小的时候可以正常显示，一旦图片大一些，很可能就无法顺利显示了，sdui的后台和浏览器是通过一种叫做websocket的协议进行通信的，它可能需要比较好的网络状况才能顺利传输图片。但是境内到境外服务器的网络质量可能达不到。</p><p>为了解决这个问题，我们弄一个图片浏览程序访问成功生成的图片。</p><p>先<code>pip3 install Flask</code>安装所需要的依赖。然后在~目录下<code>mkdir imgshow </code>创建一个imgshow文件夹用来存放图片浏览程序。imgshow下面将放两个文件，第一个是<code>app.py</code>，另一个是<code>templates</code>文件夹，里面包含一个<code>index.html</code>文件。</p><p>可以在本地准备好，然后直接上传上去。下面是文件的内容。</p><p><code>app.py</code>：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> collections </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> namedtuple</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> flask </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Flask</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> render_template</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> send_from_directory</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> request</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Flask</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">__name__</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">欢迎来到图片浏览网站！</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Image </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">namedtuple</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Image</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ctime</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_image_list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">base_path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">limit</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    image_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> root</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> dirs</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> files </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">walk</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">base_path</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> file </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> files</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lower</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">endswith</span><span style="color:#89DDFF;">((</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.gif</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.bmp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)):</span></span>
<span class="line"><span style="color:#A6ACCD;">                image_path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">root</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                rel_path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">relpath</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">image_path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> base_path</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                ctime </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getctime</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">image_path</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                image_list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Image</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">rel_path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">ctime</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">ctime</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    image_list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">img</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> img</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ctime</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">reverse</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> limit </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">        image_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> image_list</span><span style="color:#89DDFF;">[:</span><span style="color:#A6ACCD;">limit</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> image_list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/images</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">images</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    base_path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/home/ubuntu/stable-diffusion-webui/outputs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">args</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">limit</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">default</span><span style="color:#89DDFF;">=None,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">type</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    image_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_image_list</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">base_path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> limit</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">render_template</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">images</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">image_list</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/download_image/&lt;path:path&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">download_image</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    base_path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/home/ubuntu/stable-diffusion-webui/outputs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">send_from_directory</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">base_path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> path</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0.0.0.0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p><code>index.html</code>:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">doctype</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">图片浏览网站</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">图片列表</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">ul</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    {% for image in images %}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">li</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{ url_for(&#39;download_image&#39;, path=image.path) }}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">target</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_blank</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{ url_for(&#39;download_image&#39;, path=image.path) }}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{ image.name }}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">200</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">br</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        {{ image.name }}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">li</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    {% endfor %}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">ul</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>上传成功后，用<code>python app.py</code>运行图片浏览程序，这样我们可以通过访问<code>http://your-ip:8080/images?limit=5</code>获取生成的图片，将<code>your-ip</code>替换为你的公网IP。limit可以指定一次获取的图片数量。</p><h2 id="screen的应用" tabindex="-1">screen的应用 <a class="header-anchor" href="#screen的应用" aria-label="Permalink to &quot;screen的应用&quot;">​</a></h2><p>为了在断开连接后保持sdui和图片运行程序的运行，我们采用一个工具screen。安装screen：<code>sudo apt install screen</code></p><p>例如说我现在打算断开 ssh ，又希望XXXXXXXX程序继续运行：</p><p>root@xkfx:~# <code>screen -ls</code> （查看所有视窗） There is a screen on: 1883.pts-0.xkfx (03/04/2018 12:06:14 PM) (Detached) 1 Socket in /var/run/screen/S-root.</p><p>root@xkfx:~# <code>screen -dmS MyWorker</code> （创建一个新的视窗，并指定名字） root@xkfx:~# screen -ls There are screens on: 2210.MyWorker (03/04/2018 12:38:55 PM) (Detached) 1883.pts-0.xkfx (03/04/2018 12:06:15 PM) (Detached) 2 Sockets in /var/run/screen/S-root.</p><p>root@xkfx:~# <code>screen -r 2227.MyWorker</code></p><p>（<code>screen -r 2227</code> 或者 <code>screen -r MyWorker</code> 均可）</p><p>（Attached某个视窗，也可以理解为进入某个视窗）</p><p>root@xkfx:/# screen -ls There are screens on: 2227.MyWorker (03/04/2018 12:40:00 PM) (Attached) 1883.pts-0.xkfx (03/04/2018 12:06:15 PM) (Detached) 2 Sockets in /var/run/screen/S-root.</p><p>（执行你想进行的任何操作）</p><p>root@xkfx:/# cd /opt/antpool/cpuminer-2.5.0/ root@xkfx:/opt/antpool/cpuminer-2.5.0# ./minerd -o stratum+tcp://stratum-ltc.antpool.com:8888 -u xkfx.01 [2018-03-04 12:45:10] 1 miner threads started, using &#39;scrypt&#39; algorithm. [2018-03-04 12:45:10] Starting Stratum on stratum+tcp://stratum-ltc.antpool.com:8888 [2018-03-04 12:45:12] thread 0: 4104 hashes, 15.34 khash/s</p><p>[detached from 2227.MyWorker]</p><p>（退出某个视窗，但保持该视窗工作继续进行。这里的操作是 <code>Ctrl + A + D</code>）</p><p>root@xkfx:~# screen -ls There are screens on: 2227.MyWorker (03/04/2018 12:40:00 PM) (Detached) 1883.pts-0.xkfx (03/04/2018 12:06:15 PM) (Detached) 2 Sockets in /var/run/screen/S-root.</p><p>好了，现在可以断开 ssh了。</p><p>重新连接ssh，看看程序是不是仍在运行：</p><p>root@xkfx:~# screen -ls There are screens on: 2227.MyWorker (03/04/2018 12:39:59 PM) (Detached) 1883.pts-0.xkfx (03/04/2018 12:06:14 PM) (Detached) 2 Sockets in /var/run/screen/S-root.</p><p>root@xkfx:~# screen -r 2227.MyWorker</p><p>[2018-03-04 13:26:38] accepted: 28/28 (100.00%), 15.55 khash/s (yay!!!) [2018-03-04 13:27:39] accepted: 29/29 (100.00%), 15.58 khash/s (yay!!!) [2018-03-04 13:28:14] accepted: 30/30 (100.00%), 15.55 k1hash/s (yay!!!)</p><p>PS. 终结一个 screen ，切入该 screen 结束正在运行的程序， <code>Ctrl + D</code></p><h2 id="安装sd模型" tabindex="-1">安装SD模型 <a class="header-anchor" href="#安装sd模型" aria-label="Permalink to &quot;安装SD模型&quot;">​</a></h2><h3 id="获取模型的链接" tabindex="-1">获取模型的链接 <a class="header-anchor" href="#获取模型的链接" aria-label="Permalink to &quot;获取模型的链接&quot;">​</a></h3><p>例如<a href="https://civitai.com/api/download/models/80511" target="_blank" rel="noreferrer">https://civitai.com/api/download/models/80511</a></p><h3 id="切到对应目录下wget即可-附带一个-o重命名" tabindex="-1">切到对应目录下wget即可，附带一个-O重命名 <a class="header-anchor" href="#切到对应目录下wget即可-附带一个-o重命名" aria-label="Permalink to &quot;切到对应目录下wget即可，附带一个-O重命名&quot;">​</a></h3><p><code>cd stable-diffusion-webui/models/Stable-diffusion/</code></p><p><code>wget -O meinamix_meinaV10.safetensors https://civitai.com/api/download/models/80511</code></p><p><code>wget -O DreamShaper.safetensors https://civitai.com/api/download/models/78164</code></p><h2 id="安装插件-以controlnet为例" tabindex="-1">安装插件，以controlnet为例 <a class="header-anchor" href="#安装插件-以controlnet为例" aria-label="Permalink to &quot;安装插件，以controlnet为例&quot;">​</a></h2><p><code>cd stable-diffusion-webui/extensions</code>切到extensions目录下,</p><p><code>git clone https://github.com/Mikubill/sd-webui-controlnet.git</code></p><p>可以去主页看文件，插件的特征是有一个根目录包含一个scripts</p><p>然后重启sdui他会自动安装这个插件及其所需的依赖</p><p>我们到<code>https://huggingface.co/lllyasviel/ControlNet-v1-1/tree/main</code>下载所需要的controlnet模型。</p><p>同理切换到对应目录下</p><p><code>wget https://huggingface.co/lllyasviel/ControlNet-v1-1/resolve/main/control_v11p_sd15s2_lineart_anime.pth</code>即可</p><h2 id="安装过程的一些问题" tabindex="-1">安装过程的一些问题 <a class="header-anchor" href="#安装过程的一些问题" aria-label="Permalink to &quot;安装过程的一些问题&quot;">​</a></h2><h3 id="error-no-matching-distribution-found-for-gradio-3-31-0-from-r-requirements-versions-txt-line-6" tabindex="-1">ERROR: No matching distribution found for gradio==3.31.0 (from -r requirements_versions.txt (line 6)) <a class="header-anchor" href="#error-no-matching-distribution-found-for-gradio-3-31-0-from-r-requirements-versions-txt-line-6" aria-label="Permalink to &quot;ERROR: No matching distribution found for gradio==3.31.0 (from -r requirements_versions.txt (line 6))&quot;">​</a></h3><p>因为腾讯云服务器在pip的时候默认使用的是他们自己的镜像，有时候软件包不是最新的，所以出现这个问题，通过<code>pip config get global.index-url</code>可以查看当前使用的镜像<code>http://mirrors.tencentyun.com/pypi/simple</code>,通过<code>pip config set global.index-url https://pypi.org/simple</code>将源更改为官方的PyPI源可以顺利解决这个问题。</p>`,74),e=[p];function t(c,r,D,F,y,i){return a(),n("div",null,e)}const C=s(o,[["render",t]]);export{d as __pageData,C as default};
